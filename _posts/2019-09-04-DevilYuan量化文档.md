---
layout: post
title: DevilYuan量化库的UI接口
date: 2019-09-04 
tags: Study_Notes
---

# DevilYuan 量化库

## 配置

* 股票历史日线数据源配置
![img](/images/posts/Abu/17.png)

* MongoDB配置
![img](/images/posts/Abu/18.png)

* 银河证券、同花顺

-------------------

## 主界面
 
* 选股
* 股票交易
* 股票策略回测
* 股票数据

![img](/images/posts/Abu/16.png)

-------------------

## 股票数据

### 下载股票历史数据
股票历史数据支持的类型：
- 公用数据
    - 股票代码表
    - 股票交易日数据
- 个股数据
    - 个股，指数和ETF（50,300,500）历史日线数据，含如下指标
        - OHLCV
        - 成交额
        - 换手率
        - 复权因子
    - 个股和ETF（50,300,500）历史分笔数据
        - 腾讯和通达信好像不支持大盘指数的历史分笔，如果策略需要参考指数分笔数据，可以用ETF50，ETF300，ETF500代替 

### 自动更新方式
1. 手动下载某一历史**交易日**的日线数据，日期格式是yyyy-mm-dd。下载历史日线数据时，会同时下载股票代码表和对应的交易日数据。  

![img](/images/posts/Abu/22.png)
2. 手动下载步骤1里的对应的**交易日**的历史分笔数据  
![img](/images/posts/Abu/23.png)

3. 一键更新，自动更新历史日线和分笔数据到今天。如果今天是交易日，**请在18:30后更新**，因为数据源也需要数据落库。  
![img](/images/posts/Abu/24.png)

**注意：一键更新会读取数据库最新的交易日数据，根据数据库里最新的日期，自动更新到今天。也就是锚是交易日最新日期。如果分笔数据的最新日期比交易日数据早，则一键更新会导致分笔数据的缺失。当然你可以用手动更新分笔数据，来下载缺失的数据。程序会根据数据库的数据自己判断是否要下载数据。**


### 手动更新方式
1. 手动更新日线数据，输入开始日期和结束日期。如果结束日期正好是今天，并且今天是交易日，**请在18:30后更新**，因为数据源也需要数据落库。
2. 手动更新分笔数据，输入开始日期和结束日期。分笔数据的时间段可以是日线数据时间段的子集，或者一样。因为每次下载分笔数据，程序会自动根据日线数据判断出个股有没有停牌，停牌日期无须下载个股分笔数据。但建议两者时间段是一样的，这样自己不会把数据搞错位了。

### 定时一键更新
启动此功能时，程序会每天定时在18:30过几分钟的时间发起自动更新，不管当天是否是交易日。由于Python的GIL原因，**请独立开启一个程序运行定时一键更新**。

### 注意
- 当日线数据用TuShare或者TuSharePro更新时，ETF的日线数据缺少复权因子，换手率和成交额。策略中使用ETF日线数据，要注意这种情况。
- 个股TuShare日线数据的复权因子好像不是特别准确。建议用TuSharePro。
- 由于Wind会对免费账号做限流，所以下载数据最好是一段一段的下载。比如每次下载三个月或者一个月的数据。
- 历史分笔数据会优先从腾讯下载，如果没有则从通达信下载。通达信的分笔数据没有秒的信息，DevilYuan系统使用随机算法生成秒的信息。
- 若日线数据和分笔数据下载有缺失，log会分别用抬头￥DyStockDataDaysEngine￥和￥DyStockDataTicksEngine￥标示。用户可以利用此信息，再次下载补全数据。
- TuShare和TuSharePro的股票代码表，交易日数据和日线数据共用数据库的表，如果日线数据下载既使用了TuShare又使用了TuSharePro，会导致数据的不一致性。


------------------

## 选股
### 写一个实盘策略
在Stock\Trade\Strategy\Cta下添加一个策略文件，或者你可以在Stock\Trade\Strategy下创建新的目录夹，然后把策略添加到这个新目录夹下  
![img](/images/posts/Abu/25.png)
### 注意
由于支持自动载入策略到UI，策略的类名一定要跟策略的文件名一致。

### 调试股票
![img](/images/posts/Abu/19.png)

![img](/images/posts/Abu/20.png)

**各种分析图：统计描述、散列图矩阵、概率分布、词汇统计、分时图、成交分布、K线图等等等等**

### 策略回测
在主窗口打开策略回测窗口，勾选对应的策略即可回测。回测采用的类事件方式，跟实盘保持一致，这样导致回测比较慢。  
![img](/images/posts/Abu/26.png)
### 策略实盘
在主窗口打开实盘窗口。   
![img](/images/posts/Abu/27.png)

### 策略文件解析

### 策略向量回测
在Stock\Trade\Strategy\Cta下，策略DyST_DoubleMa_BT使用了向量回测。此策略是纯向量回测，由于向量回测跟实盘有不少不同，所以相应的实盘策略需要重新写。纯向量回测的策略必须以"_BT"结尾，这样实盘界面不会载入此策略。

![img](/images/posts/Abu/21.png)
